 27116: function test() {
 27116:   waitForExplicitFinish();
 27116: 
 27116:   let testPage = "http://example.org/browser/browser/base/content/test/dummy_page.html";
137506:   let tab1 = gBrowser.selectedTab = gBrowser.addTab();
137506:   tab1.linkedBrowser.addEventListener("load", (function(event) {
137506:     event.currentTarget.removeEventListener("load", arguments.callee, true);
 32534: 
 27116:     let tab2 = gBrowser.addTab();
137506:     tab2.linkedBrowser.addEventListener("load", (function(event) {
137506:       event.currentTarget.removeEventListener("load", arguments.callee, true);
 32534: 
137506:       FullZoom.enlarge();
 27116:       let tab1Zoom = ZoomManager.getZoomForBrowser(tab1.linkedBrowser);
 39808: 
137506:       afterZoom(function() {
 27116:         let tab2Zoom = ZoomManager.getZoomForBrowser(tab2.linkedBrowser);
 27116:         is(tab2Zoom, tab1Zoom, "Zoom should affect background tabs");
 32534: 
 32534:         gPrefService.setBoolPref("browser.zoom.updateBackgroundTabs", false);
137506:         FullZoom.reset();
 27116:         gBrowser.selectedTab = tab1;
 27116:         tab1Zoom = ZoomManager.getZoomForBrowser(tab1.linkedBrowser);
 27116:         tab2Zoom = ZoomManager.getZoomForBrowser(tab2.linkedBrowser);
 27116:         isnot(tab1Zoom, tab2Zoom, "Zoom should not affect background tabs");
 32534: 
 34276:         if (gPrefService.prefHasUserValue("browser.zoom.updateBackgroundTabs"))
 32534:           gPrefService.clearUserPref("browser.zoom.updateBackgroundTabs");
 27116:         gBrowser.removeTab(tab1);
 27116:         gBrowser.removeTab(tab2);
137506:         finish();
137506:       });
137506:       gBrowser.selectedTab = tab2;
137506:     }), true);
137506:     tab2.linkedBrowser.loadURI(testPage);
137506:   }), true);
137506:   content.location = testPage;
 27116: }
137506: 
137506: function afterZoom(cb) {
137506:   let oldAPTS = FullZoom._applyPrefToSetting;
137506:   FullZoom._applyPrefToSetting = function(value, browser) {
137506:     if (!value)
137506:       value = undefined;
137506:     oldAPTS.call(FullZoom, value, browser);
137506:     FullZoom._applyPrefToSetting = oldAPTS;
137506:     executeSoon(cb);
137506:   };
137506: }
