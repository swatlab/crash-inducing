 6077: <?xml version="1.0"?>
 6077: <?xml-stylesheet href="chrome://global/skin" type="text/css"?>
 6077: <?xml-stylesheet 
 6077:   href="chrome://mochikit/content/tests/SimpleTest/test.css"
 6077:   type="text/css"?>
 6077: <!--
 6077: https://bugzilla.mozilla.org/show_bug.cgi?id=253481
 6077: -->
 6077: <window title="Mozilla Bug 253481"
 6077:   xmlns:html="http://www.w3.org/1999/xhtml"
 6077:   xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
 6077: 
 6077:   <script type="application/javascript" 
 6077:           src="chrome://mochikit/content/tests/SimpleTest/SimpleTest.js"></script>      
 6077:   <script type="application/javascript" 
 6077:           src="chrome://mochikit/content/tests/SimpleTest/EventUtils.js"></script>      
 6077: 
 6077: <body  xmlns="http://www.w3.org/1999/xhtml">
 6077: <a target="_blank" href="https://bugzilla.mozilla.org/show_bug.cgi?id=253481">Mozilla Bug 253481</a>
 6077: <p id="display"></p>
 6077: <div id="content" style="display: none">
 6077:   
 6077: </div>
 6077: </body>
 6077: 
 6077: <description>
 6077:   Tests pasting of multi-line content into a single-line xul:textbox.
 6077: </description>
 6077: 
 6077: <vbox>
 6077: <textbox id="pasteintact" newlines="pasteintact"/>
 6077: <textbox id="pastetofirst" newlines="pastetofirst"/>
 6077: <textbox id="replacewithspaces" newlines="replacewithspaces"/>
 6077: <textbox id="strip" newlines="strip"/>
 6077: <textbox id="replacewithcommas" newlines="replacewithcommas"/>
 6077: <textbox id="stripsurroundingwhitespace" newlines="stripsurroundingwhitespace"/>
 6077: </vbox>
 6077: <script class="testbody" type="application/javascript;version=1.7">
 6077: <![CDATA[
 6077: /** Test for Bug 253481 **/
 6077: function testPaste(name, element, expected) {
21829:   element.value = "";
 6077:   element.focus();
 6077:   synthesizeKey("v", { accelKey: true });
 6077:   is(element.value, expected, name);
 6077: }
 6077: 
 6077: SimpleTest.waitForExplicitFinish();
 6077: 
43094: SimpleTest.waitForFocus(function() {
 6077: setTimeout(function() {
21829: var testString = "\n  hello hello  \n  world\nworld  \n";
 6077: var expectedResults = {
21829: // even "pasteintact" strips leading/trailing newlines
21829: "pasteintact": testString.replace(/^\n/, '').replace(/\n$/, ''),
21829: // "pastetofirst" strips leading newlines
21829: "pastetofirst": testString.replace(/^\n/, '').split(/\n/)[0],
21829: // "replacewithspaces" strips trailing newlines first - bug 432415
87639: "replacewithspaces": testString.replace(/\n$/, '').replace(/\n/g,' '),
21829: // "strip" is pretty straightforward
87639: "strip": testString.replace(/\n/g,''),
21829: // "replacewithcommas" strips leading and trailing newlines first
87639: "replacewithcommas": testString.replace(/^\n/, '').replace(/\n$/, '').replace(/\n/g,','),
21829: // "stripsurroundingwhitespace" strips all newlines and whitespace around them
 6077: "stripsurroundingwhitespace": testString.replace(/\s*\n\s*/g,'')
 6077: };
 6077: 
 6077: // Put a multi-line string in the clipboard
43094: SimpleTest.waitForClipboard(testString, function() {
21829:   var clip = Components.classes["@mozilla.org/widget/clipboardhelper;1"]
21829:                        .getService(Components.interfaces.nsIClipboardHelper);
21829:   clip.copyString(testString);
43094: }, function() {
 6077:   for (let [item, expected] in Iterator(expectedResults)) {
 6077:      testPaste(item, $(item), expected);
 6077:   }
 6077: 
 6077:   SimpleTest.finish();
43094: }, function() {
43094:   ok(false, "Could not copy the string to clipboard, giving up");
43094: 
43094:   SimpleTest.finish();
43094: });
 6077: }, 0);
 6077: });
 6077: 
 6077: ]]>
 6077: </script>
 6077: 
 6077: </window>
