111706: /* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 4 -*-
111706:  * vim: set ts=4 sw=4 et tw=79:
111706:  *
111706:  * ***** BEGIN LICENSE BLOCK *****
111706:  * Version: MPL 1.1/GPL 2.0/LGPL 2.1
111706:  *
111706:  * The contents of this file are subject to the Mozilla Public License Version
111706:  * 1.1 (the "License"); you may not use this file except in compliance with
111706:  * the License. You may obtain a copy of the License at
111706:  * http://www.mozilla.org/MPL/
111706:  *
111706:  * Software distributed under the License is distributed on an "AS IS" basis,
111706:  * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
111706:  * for the specific language governing rights and limitations under the
111706:  * License.
111706:  *
111706:  * The Original Code is Mozilla Communicator client code, released
111706:  * March 31, 1998.
111706:  *
111706:  * The Initial Developer of the Original Code is
111706:  * Netscape Communications Corporation.
111706:  * Portions created by the Initial Developer are Copyright (C) 1998
111706:  * the Initial Developer. All Rights Reserved.
111706:  *
111706:  * Contributor(s):
111706:  *   David Anderson <danderson@mozilla.com>
111706:  *
111706:  * Alternatively, the contents of this file may be used under the terms of
111706:  * either of the GNU General Public License Version 2 or later (the "GPL"),
111706:  * or the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
111706:  * in which case the provisions of the GPL or the LGPL are applicable instead
111706:  * of those above. If you wish to allow use of your version of this file only
111706:  * under the terms of either the GPL or the LGPL, and not to allow others to
111706:  * use your version of this file under the terms of the MPL, indicate your
111706:  * decision by deleting the provisions above and replace them with the notice
111706:  * and other provisions required by the GPL or the LGPL. If you do not delete
111706:  * the provisions above, a recipient may use your version of this file under
111706:  * the terms of any one of the MPL, the GPL or the LGPL.
111706:  *
111706:  * ***** END LICENSE BLOCK ***** */
111706: 
111706: #ifndef jsion_ion_lowering_x86_h__
111706: #define jsion_ion_lowering_x86_h__
111706: 
111962: #include "ion/shared/Lowering-shared.h"
111706: 
111706: namespace js {
111706: namespace ion {
111706: 
111962: class LIRGeneratorX86 : public LIRGeneratorShared
111706: {
111706:   public:
111732:     LIRGeneratorX86(MIRGenerator *gen, MIRGraph &graph, LIRGraph &lirGraph)
111962:       : LIRGeneratorShared(gen, graph, lirGraph)
111706:     { }
111706: 
111707:   protected:
111707:     // Uses components of a nunbox. Must be in a use request (startUsing,
111707:     // stopUsing).
111795:     LUse useType(MDefinition *mir, LUse::Policy policy);
111795:     LUse useTypeOrConstant(MDefinition *mir);
111795:     LUse usePayload(MDefinition *mir, LUse::Policy policy);
111795:     LUse usePayloadInRegister(MDefinition *mir);
111707: 
111708:     // Adds a box input to an instruction, setting operand |n| to the type and
111708:     // |n+1| to the payload. Does not modify the operands, instead expecting a
111708:     // policy to already be set.
111795:     bool fillBoxUses(LInstruction *lir, size_t n, MDefinition *mir);
111708: 
111962:     bool assignSnapshot(LInstruction *ins);
111720:     bool preparePhi(MPhi *phi);
111711: 
111962:     bool lowerForALU(LInstructionHelper<1, 2, 0> *ins, MDefinition *mir, MDefinition *lhs,
111962:                      MDefinition *rhs);
111962:     bool lowerForFPU(LInstructionHelper<1, 2, 0> *ins, MDefinition *mir, MDefinition *lhs,
111962:                      MDefinition *rhs);
111722: 
111706:   public:
111962:     bool visitConstant(MConstant *ins);
111707:     bool visitBox(MBox *box);
111707:     bool visitUnbox(MUnbox *unbox);
111706:     bool visitReturn(MReturn *ret);
111795:     bool lowerPhi(MPhi *phi);
111706: };
111706: 
111962: typedef LIRGeneratorX86 LIRGeneratorSpecific;
111706: 
111706: } // namespace js
111706: } // namespace ion
111706: 
111706: #endif // jsion_ion_lowering_x86_h__
111706: 
