 74933: /* -*- Mode: C++; tab-width: 20; indent-tabs-mode: nil; c-basic-offset: 4 -*-
 98983:  * This Source Code Form is subject to the terms of the Mozilla Public
 98983:  * License, v. 2.0. If a copy of the MPL was not distributed with this
 98983:  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 74933: 
 74933: #define MAC_OS_X_VERSION_MASK     0x0000FFFF // Not supported
 74933: #define MAC_OS_X_VERSION_10_4_HEX 0x00001040 // Not supported
 74933: #define MAC_OS_X_VERSION_10_5_HEX 0x00001050
 74933: #define MAC_OS_X_VERSION_10_6_HEX 0x00001060
 74933: #define MAC_OS_X_VERSION_10_7_HEX 0x00001070
122897: #define MAC_OS_X_VERSION_10_8_HEX 0x00001080
 74933: 
 74933: // This API will not work for OS X 10.10, see Gestalt.h.
 74933: 
 74933: #include "nsCocoaFeatures.h"
 74933: #include "nsDebug.h"
 98723: #include "nsObjCExceptions.h"
 74933: 
 74933: #import <Cocoa/Cocoa.h>
 74933: 
108991: int32_t nsCocoaFeatures::mOSXVersion = 0;
 74933: 
108991: /* static */ int32_t
 74933: nsCocoaFeatures::OSXVersion()
 74933: {
 98723:     NS_OBJC_BEGIN_TRY_ABORT_BLOCK_RETURN;
 98723: 
 74933:     if (!mOSXVersion) {
 74933:         // minor version is not accurate, use gestaltSystemVersionMajor, 
 74933:         // gestaltSystemVersionMinor, gestaltSystemVersionBugFix for these
 74933:         OSErr err = ::Gestalt(gestaltSystemVersion, reinterpret_cast<SInt32*>(&mOSXVersion));
 74933:         if (err != noErr) {
 74933:             // This should probably be changed when our minimum version changes
 74933:             NS_ERROR("Couldn't determine OS X version, assuming 10.5");
 74933:             mOSXVersion = MAC_OS_X_VERSION_10_5_HEX;
 74933:         }
 74933:         mOSXVersion &= MAC_OS_X_VERSION_MASK;
 74933:     }
 74933:     return mOSXVersion;
 98723: 
 98723:     NS_OBJC_END_TRY_ABORT_BLOCK_RETURN(0);
 74933: }
 74933: 
 79445: /* static */ bool
 86966: nsCocoaFeatures::SupportCoreAnimationPlugins()
 86966: {
 86966:     // Disallow Core Animation on 10.5 because of crashes.
 86966:     // See Bug 711564.
 86966:     return (OSXVersion() >= MAC_OS_X_VERSION_10_6_HEX);
 86966: }
 86966: 
 86966: /* static */ bool
 74933: nsCocoaFeatures::OnLionOrLater()
 74933: {
 74933:     return (OSXVersion() >= MAC_OS_X_VERSION_10_7_HEX);
 74933: }
 74933: 
122897: /* static */ bool
122897: nsCocoaFeatures::OnMountainLionOrLater()
122897: {
122897:     return (OSXVersion() >= MAC_OS_X_VERSION_10_8_HEX);
122897: }
122897: 
