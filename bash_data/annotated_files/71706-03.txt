    1: /* -*- Mode: C; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 4 -*-
    1:  *
    1:  * ***** BEGIN LICENSE BLOCK *****
    1:  * Version: MPL 1.1/GPL 2.0/LGPL 2.1
    1:  *
    1:  * The contents of this file are subject to the Mozilla Public License Version
    1:  * 1.1 (the "License"); you may not use this file except in compliance with
    1:  * the License. You may obtain a copy of the License at
    1:  * http://www.mozilla.org/MPL/
    1:  *
    1:  * Software distributed under the License is distributed on an "AS IS" basis,
    1:  * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
    1:  * for the specific language governing rights and limitations under the
    1:  * License.
    1:  *
    1:  * The Original Code is Mozilla Communicator client code, released
    1:  * March 31, 1998.
    1:  *
    1:  * The Initial Developer of the Original Code is
    1:  * Netscape Communications Corporation.
    1:  * Portions created by the Initial Developer are Copyright (C) 1998
    1:  * the Initial Developer. All Rights Reserved.
    1:  *
    1:  * Contributor(s):
    1:  *   IBM Corp.
    1:  *
    1:  * Alternatively, the contents of this file may be used under the terms of
    1:  * either of the GNU General Public License Version 2 or later (the "GPL"),
    1:  * or the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
    1:  * in which case the provisions of the GPL or the LGPL are applicable instead
    1:  * of those above. If you wish to allow use of your version of this file only
    1:  * under the terms of either the GPL or the LGPL, and not to allow others to
    1:  * use your version of this file under the terms of the MPL, indicate your
    1:  * decision by deleting the provisions above and replace them with the notice
    1:  * and other provisions required by the GPL or the LGPL. If you do not delete
    1:  * the provisions above, a recipient may use your version of this file under
    1:  * the terms of any one of the MPL, the GPL or the LGPL.
    1:  *
    1:  * ***** END LICENSE BLOCK ***** */
    1: 
    1: #ifndef _LIBMATH_H
    1: #define _LIBMATH_H
    1: 
    1: #include <math.h>
52657: #ifdef XP_WIN
52657: # include "jsnum.h"
52657: #endif
    1: 
    1: /*
    1:  * Use system provided math routines.
    1:  */
    1: 
    1: /* The right copysign function is not always named the same thing. */
    1: #if __GNUC__ >= 4 || (__GNUC__ == 3 && __GNUC_MINOR__ >= 4)
20767: #define js_copysign __builtin_copysign
    1: #elif defined _WIN32
    1: #if _MSC_VER < 1400
31639: /* Try to work around apparent _copysign bustage in VC7.x. */
20767: #define js_copysign js_copysign
    1: extern double js_copysign(double, double);
    1: #else
20767: #define js_copysign _copysign
    1: #endif
    1: #else
20767: #define js_copysign copysign
    1: #endif
    1: 
71706: #if defined(_M_X64) && _MSC_VER <= 1500
71706: // This is a workaround for fmod bug (http://support.microsoft.com/kb/982107)
71706: extern "C" double js_myfmod(double x, double y);
71706: #define fmod js_myfmod
71706: #endif
71706: 
30268: /* Consistency wrapper for platform deviations in fmod() */
30268: static inline double
30268: js_fmod(double d, double d2)
30268: {
30268: #ifdef XP_WIN
30268:     /*
30268:      * Workaround MS fmod bug where 42 % (1/0) => NaN, not 42.
30268:      * Workaround MS fmod bug where -0 % -N => 0, not -0.
30268:      */
30268:     if ((JSDOUBLE_IS_FINITE(d) && JSDOUBLE_IS_INFINITE(d2)) ||
30268:         (d == 0 && JSDOUBLE_IS_FINITE(d2))) {
30268:         return d;
30268:     }
30268: #endif
30268:     return fmod(d, d2);
30268: }
30268: 
    1: #endif /* _LIBMATH_H */
    1: 
