43628: /* -*- Mode: C++; tab-width: 20; indent-tabs-mode: nil; c-basic-offset: 4 -*-
43628:  * ***** BEGIN LICENSE BLOCK *****
43628:  * Version: MPL 1.1/GPL 2.0/LGPL 2.1
43628:  *
43628:  * The contents of this file are subject to the Mozilla Public License Version
43628:  * 1.1 (the "License"); you may not use this file except in compliance with
43628:  * the License. You may obtain a copy of the License at
43628:  * http://www.mozilla.org/MPL/
43628:  *
43628:  * Software distributed under the License is distributed on an "AS IS" basis,
43628:  * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
43628:  * for the specific language governing rights and limitations under the
43628:  * License.
43628:  *
43628:  * The Initial Developer of the Original Code is Mozilla Foundation.
43628:  * Portions created by the Initial Developer are Copyright (C) 2010
43628:  * the Initial Developer. All Rights Reserved.
43628:  *
43628:  * Contributor(s):
43628:  *   Bas Schouten <bschouten@mozilla.com>
43628:  *   Vladimir Vukicevic <vladimir@pobox.com>
43628:  *   Matt Woodrow <mwoodrow@mozilla.com>
43628:  *
43628:  * Alternatively, the contents of this file may be used under the terms of
43628:  * either the GNU General Public License Version 2 or later (the "GPL"), or
43628:  * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
43628:  * in which case the provisions of the GPL or the LGPL are applicable instead
43628:  * of those above. If you wish to allow use of your version of this file only
43628:  * under the terms of either the GPL or the LGPL, and not to allow others to
43628:  * use your version of this file under the terms of the MPL, indicate your
43628:  * decision by deleting the provisions above and replace them with the notice
43628:  * and other provisions required by the GPL or the LGPL. If you do not delete
43628:  * the provisions above, a recipient may use your version of this file under
43628:  * the terms of any one of the MPL, the GPL or the LGPL.
43628:  *
43628:  * ***** END LICENSE BLOCK ***** */
43628: 
43628: #include "GLContext.h"
43628: typedef realGLboolean GLboolean;
43628: #include <GL/glx.h>
43628: 
43628: namespace mozilla {
43628: namespace gl {
43628: 
43628: class GLXLibrary
43628: {
43628: public:
57245:     GLXLibrary() : mInitialized(PR_FALSE), mTriedInitializing(PR_FALSE),
57245:                    mOGLLibrary(nsnull) {}
43628: 
57241:     typedef void (GLAPIENTRY * PFNGLXDESTROYCONTEXTPROC) (Display*,
43628:                                                           GLXContext);
57241:     PFNGLXDESTROYCONTEXTPROC xDestroyContext;
43628:     typedef Bool (GLAPIENTRY * PFNGLXMAKECURRENTPROC) (Display*,
43628:                                                        GLXDrawable,
43628:                                                        GLXContext);
43628:     PFNGLXMAKECURRENTPROC xMakeCurrent;
54359:     typedef GLXContext (GLAPIENTRY * PFNGLXGETCURRENTCONTEXT) ();
54359:     PFNGLXGETCURRENTCONTEXT xGetCurrentContext;
43628:     typedef void* (GLAPIENTRY * PFNGLXGETPROCADDRESSPROC) (const char *);
43628:     PFNGLXGETPROCADDRESSPROC xGetProcAddress;
43628:     typedef GLXFBConfig* (GLAPIENTRY * PFNGLXCHOOSEFBCONFIG) (Display *,
43628:                                                               int,
43628:                                                               const int *,
43628:                                                               int *);
43628:     PFNGLXCHOOSEFBCONFIG xChooseFBConfig;
44139:     typedef GLXFBConfig* (GLAPIENTRY * PFNGLXGETFBCONFIGS) (Display *,
44139:                                                             int,
44139:                                                             int *);
44139:     PFNGLXGETFBCONFIGS xGetFBConfigs;
43628:     typedef GLXContext (GLAPIENTRY * PFNGLXCREATENEWCONTEXT) (Display *,
43628:                                                               GLXFBConfig,
43628:                                                               int,
43628:                                                               GLXContext,
43628:                                                               Bool);
43628:     PFNGLXCREATENEWCONTEXT xCreateNewContext;
43628:     typedef XVisualInfo* (GLAPIENTRY * PFNGLXGETVISUALFROMFBCONFIG) (Display *,
43628:                                                                      GLXFBConfig);
43628:     PFNGLXGETVISUALFROMFBCONFIG xGetVisualFromFBConfig;
44139:     typedef int (GLAPIENTRY * PFNGLXGETFBCONFIGATTRIB) (Display *, 
44139:                                                         GLXFBConfig,
44139:                                                         int,
44139:                                                         int *);
44139:     PFNGLXGETFBCONFIGATTRIB xGetFBConfigAttrib;
44139: 
44139:     typedef void (GLAPIENTRY * PFNGLXSWAPBUFFERS) (Display *,
44139:                                                    GLXDrawable);
44139:     PFNGLXSWAPBUFFERS xSwapBuffers;
57244:     typedef const char * (GLAPIENTRY * PFNGLXQUERYEXTENSIONSSTRING) (Display *,
57244:                                                                      int);
57244:     PFNGLXQUERYEXTENSIONSSTRING xQueryExtensionsString;
63995:     typedef const char * (GLAPIENTRY * PFNGLXGETCLIENTSTRING) (Display *,
63995:                                                                int);
63995:     PFNGLXGETCLIENTSTRING xGetClientString;
44139:     typedef const char * (GLAPIENTRY * PFNGLXQUERYSERVERSTRING) (Display *,
44139:                                                                  int,
44139:                                                                  int);
44139:     PFNGLXQUERYSERVERSTRING xQueryServerString;
43628: 
47908:     typedef GLXPixmap (GLAPIENTRY * PFNGLXCREATEPIXMAP) (Display *,
47908:                                                          GLXFBConfig,
47908:                                                          Pixmap,
47908:                                                          const int *);
47908:     PFNGLXCREATEPIXMAP xCreatePixmap;
57246:     typedef GLXPixmap (GLAPIENTRY * PFNGLXCREATEGLXPIXMAPWITHCONFIG)
57246:                                                         (Display *,
57246:                                                          GLXFBConfig,
57246:                                                          Pixmap);
57246:     PFNGLXCREATEGLXPIXMAPWITHCONFIG xCreateGLXPixmapWithConfig;
47908:     typedef void (GLAPIENTRY * PFNGLXDESTROYPIXMAP) (Display *,
47908:                                                      GLXPixmap);
47908:     PFNGLXDESTROYPIXMAP xDestroyPixmap;
47908:     typedef GLXContext (GLAPIENTRY * PFNGLXCREATECONTEXT) (Display *,
47908:                                                            XVisualInfo *,
47908:                                                            GLXContext,
47908:                                                            Bool);
47908:     PFNGLXCREATECONTEXT xCreateContext;
57247:     typedef Bool (GLAPIENTRY * PFNGLXQUERYVERSION) (Display *,
57247:                                                     int *,
57247:                                                     int *);
57247:     PFNGLXQUERYVERSION xQueryVersion;
47908: 
43628:     PRBool EnsureInitialized();
43628: 
43628: private:
43628:     PRBool mInitialized;
57245:     PRBool mTriedInitializing;
43628:     PRLibrary *mOGLLibrary;
43628: };
43628: 
43628: // a global GLXLibrary instance
43628: extern GLXLibrary sGLXLibrary;
43628: 
43628: } /* namespace gl */
43628: } /* namespace mozilla */
43628: 
