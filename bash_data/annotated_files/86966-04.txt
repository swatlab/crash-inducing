74933: /* -*- Mode: C++; tab-width: 20; indent-tabs-mode: nil; c-basic-offset: 4 -*-
74933:  * ***** BEGIN LICENSE BLOCK *****
74933:  * Version: MPL 1.1/GPL 2.0/LGPL 2.1
74933:  *
74933:  * The contents of this file are subject to the Mozilla Public License Version
74933:  * 1.1 (the "License"); you may not use this file except in compliance with
74933:  * the License. You may obtain a copy of the License at
74933:  * http://www.mozilla.org/MPL/
74933:  *
74933:  * Software distributed under the License is distributed on an "AS IS" basis,
74933:  * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
74933:  * for the specific language governing rights and limitations under the
74933:  * License.
74933:  *
74933:  * The Original Code is thebes gfx code.
74933:  *
74933:  * The Initial Developer of the Original Code is Mozilla Foundation.
74933:  * Portions created by the Initial Developer are Copyright (C) 2011
74933:  * the Initial Developer. All Rights Reserved.
74933:  *
74933:  * Contributor(s):
74933:  *   Benoit Girard <bgirard@mozilla.com>
74933:  *
74933:  * Alternatively, the contents of this file may be used under the terms of
74933:  * either the GNU General Public License Version 2 or later (the "GPL"), or
74933:  * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
74933:  * in which case the provisions of the GPL or the LGPL are applicable instead
74933:  * of those above. If you wish to allow use of your version of this file only
74933:  * under the terms of either the GPL or the LGPL, and not to allow others to
74933:  * use your version of this file under the terms of the MPL, indicate your
74933:  * decision by deleting the provisions above and replace them with the notice
74933:  * and other provisions required by the GPL or the LGPL. If you do not delete
74933:  * the provisions above, a recipient may use your version of this file under
74933:  * the terms of any one of the MPL, the GPL or the LGPL.
74933:  *
74933:  * ***** END LICENSE BLOCK ***** */
74933: 
74933: #define MAC_OS_X_VERSION_MASK     0x0000FFFF // Not supported
74933: #define MAC_OS_X_VERSION_10_4_HEX 0x00001040 // Not supported
74933: #define MAC_OS_X_VERSION_10_5_HEX 0x00001050
74933: #define MAC_OS_X_VERSION_10_6_HEX 0x00001060
74933: #define MAC_OS_X_VERSION_10_7_HEX 0x00001070
74933: 
74933: // This API will not work for OS X 10.10, see Gestalt.h.
74933: 
74933: #include "nsCocoaFeatures.h"
74933: #include "nsDebug.h"
74933: 
74933: #import <Cocoa/Cocoa.h>
74933: 
74933: PRInt32 nsCocoaFeatures::mOSXVersion = 0;
74933: 
74933: /* static */ PRInt32
74933: nsCocoaFeatures::OSXVersion()
74933: {
74933:     if (!mOSXVersion) {
74933:         // minor version is not accurate, use gestaltSystemVersionMajor, 
74933:         // gestaltSystemVersionMinor, gestaltSystemVersionBugFix for these
74933:         OSErr err = ::Gestalt(gestaltSystemVersion, reinterpret_cast<SInt32*>(&mOSXVersion));
74933:         if (err != noErr) {
74933:             // This should probably be changed when our minimum version changes
74933:             NS_ERROR("Couldn't determine OS X version, assuming 10.5");
74933:             mOSXVersion = MAC_OS_X_VERSION_10_5_HEX;
74933:         }
74933:         mOSXVersion &= MAC_OS_X_VERSION_MASK;
74933:     }
74933:     return mOSXVersion;
74933: }
74933: 
79445: /* static */ bool
86966: nsCocoaFeatures::SupportCoreAnimationPlugins()
86966: {
86966:     // Disallow Core Animation on 10.5 because of crashes.
86966:     // See Bug 711564.
86966:     return (OSXVersion() >= MAC_OS_X_VERSION_10_6_HEX);
86966: }
86966: 
86966: /* static */ bool
74933: nsCocoaFeatures::OnSnowLeopardOrLater()
74933: {
74933:     return (OSXVersion() >= MAC_OS_X_VERSION_10_6_HEX);
74933: }
74933: 
79445: /* static */ bool
74933: nsCocoaFeatures::OnLionOrLater()
74933: {
74933:     return (OSXVersion() >= MAC_OS_X_VERSION_10_7_HEX);
74933: }
74933: 
