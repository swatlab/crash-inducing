105741: /* -*- Mode: c++; c-basic-offset: 2; indent-tabs-mode: nil; tab-width: 40 -*- */
105741: /* vim: set ts=2 et sw=2 tw=40: */
105741: /* This Source Code Form is subject to the terms of the Mozilla Public
105741:  * License, v. 2.0. If a copy of the MPL was not distributed with this
105741:  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
105741: 
131512: #ifndef mozilla_dom_voicemail_voicemail_h__
131512: #define mozilla_dom_voicemail_voicemail_h__
105741: 
159127: #include "mozilla/Attributes.h"
159127: #include "mozilla/ErrorResult.h"
105741: #include "nsDOMEvent.h"
105741: #include "nsDOMEventTargetHelper.h"
135134: #include "nsIVoicemailProvider.h"
105741: 
159127: class JSObject;
159127: struct JSContext;
159127: 
131512: class nsPIDOMWindow;
105741: class nsIDOMMozVoicemailStatus;
105741: 
131512: namespace mozilla {
131512: namespace dom {
105741: 
159127: class Voicemail MOZ_FINAL : public nsDOMEventTargetHelper
105741: {
135134:   /**
135134:    * Class Voicemail doesn't actually inherit nsIVoicemailListener. Instead, it
135134:    * owns an nsIVoicemailListener derived instance mListener and passes it to
135134:    * nsIVoicemailProvider. The onreceived events are first delivered to
135134:    * mListener and then forwarded to its owner, Voicemail. See also bug 775997
135134:    * comment #51.
135134:    */
135134:   class Listener;
135134: 
105741: public:
135134:   NS_DECL_NSIVOICEMAILLISTENER
105741: 
140775:   NS_REALLY_FORWARD_NSIDOMEVENTTARGET(nsDOMEventTargetHelper)
105741: 
135134:   Voicemail(nsPIDOMWindow* aWindow, nsIVoicemailProvider* aProvider);
159127: 
105741:   virtual ~Voicemail();
105741: 
159127:   nsPIDOMWindow*
159127:   GetParentObject() const
159127:   {
159127:     return GetOwner();
159127:   }
159127: 
159127:   virtual JSObject*
159127:   WrapObject(JSContext* aCx, JS::Handle<JSObject*> aScope) MOZ_OVERRIDE;
159127: 
159127:   already_AddRefed<nsIDOMMozVoicemailStatus>
169293:   GetStatus(ErrorResult& aRv) const;
159127: 
159127:   void
169293:   GetNumber(nsString& aNumber, ErrorResult& aRv) const;
159127: 
159127:   void
169293:   GetDisplayName(nsString& aDisplayName, ErrorResult& aRv) const;
159127: 
159127:   IMPL_EVENT_HANDLER(statuschanged)
159127: 
105741: private:
135134:   nsCOMPtr<nsIVoicemailProvider> mProvider;
135134:   nsRefPtr<Listener> mListener;
105741: };
105741: 
131512: } // namespace dom
131512: } // namespace mozilla
105741: 
131512: nsresult
159127: NS_NewVoicemail(nsPIDOMWindow* aWindow,
159127:                 mozilla::dom::Voicemail** aVoicemail);
131512: 
131512: #endif // mozilla_dom_voicemail_voicemail_h__
