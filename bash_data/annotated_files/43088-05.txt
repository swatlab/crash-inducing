29805: /* ***** BEGIN LICENSE BLOCK *****
29805:  * Version: MPL 1.1/GPL 2.0/LGPL 2.1
29805:  *
29805:  * The contents of this file are subject to the Mozilla Public License Version
29805:  * 1.1 (the "License"); you may not use this file except in compliance with
29805:  * the License. You may obtain a copy of the License at
29805:  * http://www.mozilla.org/MPL/
29805:  *
29805:  * Software distributed under the License is distributed on an "AS IS" basis,
29805:  * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
29805:  * for the specific language governing rights and limitations under the
29805:  * License.
29805:  *
29805:  * The Original Code is HTML Parser C++ Translator code.
29805:  *
29805:  * The Initial Developer of the Original Code is
29805:  * Mozilla Foundation.
29805:  * Portions created by the Initial Developer are Copyright (C) 2008-2009
29805:  * the Initial Developer. All Rights Reserved.
29805:  *
29805:  * Contributor(s):
29805:  *   Henri Sivonen <hsivonen@iki.fi>
29805:  *
29805:  * Alternatively, the contents of this file may be used under the terms of
29805:  * either the GNU General Public License Version 2 or later (the "GPL"), or
29805:  * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
29805:  * in which case the provisions of the GPL or the LGPL are applicable instead
29805:  * of those above. If you wish to allow use of your version of this file only
29805:  * under the terms of either the GPL or the LGPL, and not to allow others to
29805:  * use your version of this file under the terms of the MPL, indicate your
29805:  * decision by deleting the provisions above and replace them with the notice
29805:  * and other provisions required by the GPL or the LGPL. If you do not delete
29805:  * the provisions above, a recipient may use your version of this file under
29805:  * the terms of any one of the MPL, the GPL or the LGPL.
29805:  *
29805:  * ***** END LICENSE BLOCK ***** */
29805: 
34978: #define NS_HTML5_TREE_BUILDER_HANDLE_ARRAY_LENGTH 512
34978: 
29805:   private:
29805: 
32917:     nsTArray<nsHtml5TreeOperation>         mOpQueue;
39737:     nsTArray<nsHtml5SpeculativeLoad>       mSpeculativeLoadQueue;
34979:     nsAHtml5TreeOpSink*                    mOpSink;
34978:     nsAutoArrayPtr<nsIContent*>            mHandles;
34978:     PRInt32                                mHandlesUsed;
34978:     nsTArray<nsAutoArrayPtr<nsIContent*> > mOldHandles;
39737:     nsHtml5TreeOpStage*                    mSpeculativeLoadStage;
43088:     nsIContent**                           mDeepTreeSurrogateParent;
35607:     PRBool                                 mCurrentHtmlScriptIsAsyncOrDefer;
29805: #ifdef DEBUG
29805:     PRBool                                 mActive;
29805: #endif
29805: 
34978:     // DocumentModeHandler
34978:     /**
34978:      * Tree builder uses this to report quirkiness of the document
34978:      */
34978:     void documentMode(nsHtml5DocumentMode m);
34978: 
34978:     nsIContent** AllocateContentHandle();
34978:     
29805:   public:
29805: 
38132:     nsHtml5TreeBuilder(nsAHtml5TreeOpSink* aOpSink,
39737:                        nsHtml5TreeOpStage* aStage);
29805: 
29805:     ~nsHtml5TreeBuilder();
29805:     
35600:     PRBool IsDiscretionaryFlushSafe();
35600: 
34979:     PRBool HasScript();
34979:     
34979:     void SetOpSink(nsAHtml5TreeOpSink* aOpSink) {
34979:       mOpSink = aOpSink;
32917:     }
32917: 
35295:     void ClearOps() {
35295:       mOpQueue.Clear();
35295:     }
35295:     
39737:     PRBool Flush();
34981:     
39737:     void FlushLoads();
34978: 
39511:     void SetDocumentCharset(nsACString& aCharset, PRInt32 aCharsetSource);
34978: 
34979:     void StreamEnded();
34979: 
34979:     void NeedsCharsetSwitchTo(const nsACString& aEncoding);
34979: 
35294:     void AddSnapshotToScript(nsAHtml5TreeBuilderState* aSnapshot, PRInt32 aLine);
