 7677: <!DOCTYPE HTML>
 7677: <html>
 7677: <head>
 7677:   <title>Test Character Movement (including nsTextFrame::PeekOffsetCharacter)</title>
 7677:   <script type="text/javascript" src="/MochiKit/MochiKit.js"></script>
 7677:   <script type="text/javascript" src="/tests/SimpleTest/SimpleTest.js"></script>
 7677:   <script type="application/javascript" src="/tests/SimpleTest/EventUtils.js"></script>
 7677:   <link rel="stylesheet" type="text/css" href="/tests/SimpleTest/test.css" />
 7677: </head>
 7677: <body>
 7677: <p id="display"></p>
 7677: <div id="content" style="display: block">
 7677: <div contentEditable id="editor"></div>
 7677: </div>
 7677: <pre id="test">
 7677: <script class="testbody" type="text/javascript;version=1.7">
 7677: 
 7677: SimpleTest.waitForExplicitFinish();
 7677: 
 7677: // This seems to be necessary because the selection is not set up properly otherwise
27682: addLoadEvent(function() { SimpleTest.executeSoon(test); });
 7677: 
 7677: function test() {
 7677:   var sel = window.getSelection();
 7677:   var editor = document.getElementById("editor");
 7677: 
 7677:   function testRight(node, offset) {
 7677:     synthesizeKey("VK_RIGHT", {});
 7677:     is(sel.anchorNode, node, "Right movement broken in " + editor.innerHTML);
 7677:     is(sel.anchorOffset, offset, "Right movement broken in " + editor.innerHTML);
 7677:   }
 7677: 
 7677:   function testLeft(node, offset) {
 7677:     synthesizeKey("VK_LEFT", {});
 7677:     is(sel.anchorNode, node, "Left movement broken in " + editor.innerHTML);
 7677:     is(sel.anchorOffset, offset, "Left movement broken in " + editor.innerHTML);
 7677:   }
 7677: 
 7677:   editor.innerHTML = "H K";
 7677:   sel.collapse(editor.firstChild, 0);
 7677:   testRight(editor.firstChild, 1);
 7677:   testRight(editor.firstChild, 2);
 7677:   testRight(editor.firstChild, 3);
 7677:   testLeft(editor.firstChild, 2);
 7677:   testLeft(editor.firstChild, 1);
 7677:   testLeft(editor.firstChild, 0);
 7677: 
 7677:   editor.innerHTML = "<b>H</b> K";
 7677:   sel.collapse(editor.firstChild.firstChild, 0);
 7677:   testRight(editor.firstChild.firstChild, 1);
 7677:   testRight(editor.firstChild.nextSibling, 1);
 7677:   testRight(editor.firstChild.nextSibling, 2);
 7677:   testLeft(editor.firstChild.nextSibling, 1);
 7677:   testLeft(editor.firstChild.nextSibling, 0);
 7677:   testLeft(editor.firstChild.firstChild, 0);
 7677: 
 7677:   editor.innerHTML = "H <br>K";
 7677:   sel.collapse(editor.firstChild, 0);
 7677:   testRight(editor.firstChild, 1);
 7677:   testRight(editor.firstChild, 2);
 7677:   testRight(editor.firstChild.nextSibling.nextSibling, 0);
 7677:   testRight(editor.firstChild.nextSibling.nextSibling, 1);
 7677:   testLeft(editor.firstChild.nextSibling.nextSibling, 0);
 7677:   testLeft(editor, 1);
 7677:   testLeft(editor.firstChild, 1);
 7677:   testLeft(editor.firstChild, 0);
 7677: 
 8085:   editor.innerHTML = "<pre>aa\nbb</pre>";
 8085:   sel.collapse(editor.firstChild.firstChild, 0);
 8085:   testRight(editor.firstChild.firstChild, 1);
 8085:   // at the 'bb' but HINTLEFT so appears at the end of the first line
 8085:   testRight(editor.firstChild.firstChild, 3);  
 8085:   testRight(editor.firstChild.firstChild, 3);
 8085:   testRight(editor.firstChild.firstChild, 4);
 8085:   testLeft(editor.firstChild.firstChild, 3);
 8085:   // at the 'bb' but HINTLEFT so appears at the end of the first line
 8085:   testLeft(editor.firstChild.firstChild, 3);
 8085:   testLeft(editor.firstChild.firstChild, 1);
 8085:   testLeft(editor.firstChild.firstChild, 0);
 8085: 
 7677:   SimpleTest.finish();
 7677: }
 7677: 
 7677: 
 7677: </script>
 7677: </pre>
 7677: </body>
 7677: </html>
