    1: /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */
    1: /* ***** BEGIN LICENSE BLOCK *****
    1:  * Version: MPL 1.1/GPL 2.0/LGPL 2.1
    1:  *
    1:  * The contents of this file are subject to the Mozilla Public License Version
    1:  * 1.1 (the "License"); you may not use this file except in compliance with
    1:  * the License. You may obtain a copy of the License at
    1:  * http://www.mozilla.org/MPL/
    1:  *
    1:  * Software distributed under the License is distributed on an "AS IS" basis,
    1:  * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
    1:  * for the specific language governing rights and limitations under the
    1:  * License.
    1:  *
    1:  * The Original Code is Mozilla Communicator client code.
    1:  *
    1:  * The Initial Developer of the Original Code is
    1:  * Netscape Communications Corporation.
    1:  * Portions created by the Initial Developer are Copyright (C) 1998
    1:  * the Initial Developer. All Rights Reserved.
    1:  *
    1:  * Contributor(s):
    1:  *   Original Author: David W. Hyatt (hyatt@netscape.com)
    1:  *
    1:  * Alternatively, the contents of this file may be used under the terms of
    1:  * either of the GNU General Public License Version 2 or later (the "GPL"),
    1:  * or the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
    1:  * in which case the provisions of the GPL or the LGPL are applicable instead
    1:  * of those above. If you wish to allow use of your version of this file only
    1:  * under the terms of either the GPL or the LGPL, and not to allow others to
    1:  * use your version of this file under the terms of the MPL, indicate your
    1:  * decision by deleting the provisions above and replace them with the notice
    1:  * and other provisions required by the GPL or the LGPL. If you do not delete
    1:  * the provisions above, a recipient may use your version of this file under
    1:  * the terms of any one of the MPL, the GPL or the LGPL.
    1:  *
    1:  * ***** END LICENSE BLOCK ***** */
    1: 
    1: #include "nsXBLInsertionPoint.h"
14228: #include "nsContentUtils.h"
23385: #include "nsXBLBinding.h"
    1: 
    1: nsXBLInsertionPoint::nsXBLInsertionPoint(nsIContent* aParentElement,
    1:                                          PRUint32 aIndex,
    1:                                          nsIContent* aDefaultContent)
    1:   : mParentElement(aParentElement),
    1:     mIndex(aIndex),
    1:     mDefaultContentTemplate(aDefaultContent)
    1: {
    1: }
    1: 
    1: nsXBLInsertionPoint::~nsXBLInsertionPoint()
    1: {
23385:   if (mDefaultContent) {
23385:     nsXBLBinding::UninstallAnonymousContent(mDefaultContent->GetOwnerDoc(),
23385:                                             mDefaultContent);
23385:   }
    1: }
    1: 
    1: nsrefcnt
    1: nsXBLInsertionPoint::Release()
    1: {
    1:   --mRefCnt;
    1:   NS_LOG_RELEASE(this, mRefCnt, "nsXBLInsertionPoint");
    1:   if (mRefCnt == 0) {
    1:     mRefCnt = 1;
    1:     delete this;
    1:     return 0;
    1:   }
    1:   return mRefCnt;
    1: }
    1: 
 7230: NS_IMPL_CYCLE_COLLECTION_CLASS(nsXBLInsertionPoint)
 1829: NS_IMPL_CYCLE_COLLECTION_UNLINK_BEGIN_NATIVE(nsXBLInsertionPoint)
 1829:   NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMARRAY(mElements)
 1829:   NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(mDefaultContentTemplate)
23385:   if (tmp->mDefaultContent) {
23385:     nsXBLBinding::UninstallAnonymousContent(tmp->mDefaultContent->GetOwnerDoc(),
23385:                                             tmp->mDefaultContent);
23385:   }
 1829:   NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(mDefaultContent)
 1829: NS_IMPL_CYCLE_COLLECTION_UNLINK_END
 1829: NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NATIVE_BEGIN(nsXBLInsertionPoint)
 1829:   NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMARRAY(mElements)
 1829:   NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(mDefaultContentTemplate)
 1829:   NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(mDefaultContent)
 1829: NS_IMPL_CYCLE_COLLECTION_TRAVERSE_END
 1829: NS_IMPL_CYCLE_COLLECTION_ROOT_NATIVE(nsXBLInsertionPoint, AddRef)
 1829: NS_IMPL_CYCLE_COLLECTION_UNROOT_NATIVE(nsXBLInsertionPoint, Release)
 1829: 
19130: nsIContent*
    1: nsXBLInsertionPoint::GetInsertionParent()
    1: {
    1:   return mParentElement;
    1: }
    1: 
19130: nsIContent*
    1: nsXBLInsertionPoint::GetDefaultContent()
    1: {
19130:   return mDefaultContent;
    1: }
    1: 
19130: nsIContent*
    1: nsXBLInsertionPoint::GetDefaultContentTemplate()
    1: {
19130:   return mDefaultContentTemplate;
    1: }
    1: 
19130: nsIContent*
    1: nsXBLInsertionPoint::ChildAt(PRUint32 aIndex)
    1: {
19130:   return mElements.ObjectAt(aIndex);
    1: }
    1: 
    1: PRBool
    1: nsXBLInsertionPoint::Matches(nsIContent* aContent, PRUint32 aIndex)
    1: {
    1:   return (aContent == mParentElement && mIndex != -1 && ((PRInt32)aIndex) == mIndex);
    1: }
10861: 
10861: void
10861: nsXBLInsertionPoint::UnbindDefaultContent()
10861: {
10861:   if (!mDefaultContent) {
10861:     return;
10861:   }
10861: 
23385:   // Undo InstallAnonymousContent.
23385:   nsXBLBinding::UninstallAnonymousContent(mDefaultContent->GetOwnerDoc(),
23385:                                           mDefaultContent);
10861: }
