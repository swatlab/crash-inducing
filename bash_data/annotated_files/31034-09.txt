16295: /********************************************************************
16295:  *                                                                  *
16295:  * THIS FILE IS PART OF THE OggVorbis SOFTWARE CODEC SOURCE CODE.   *
16295:  * USE, DISTRIBUTION AND REPRODUCTION OF THIS LIBRARY SOURCE IS     *
16295:  * GOVERNED BY A BSD-STYLE SOURCE LICENSE INCLUDED WITH THIS SOURCE *
16295:  * IN 'COPYING'. PLEASE READ THESE TERMS BEFORE DISTRIBUTING.       *
16295:  *                                                                  *
31034:  * THE OggVorbis SOURCE CODE IS (C) COPYRIGHT 1994-2009             *
16295:  * by the Xiph.Org Foundation http://www.xiph.org/                  *
16295:  *                                                                  *
16295:  ********************************************************************
16295: 
16295:  function: PCM data envelope analysis and manipulation
31034:  last mod: $Id: envelope.h 16227 2009-07-08 06:58:46Z xiphmont $
16295: 
16295:  ********************************************************************/
16295: 
16295: #ifndef _V_ENVELOPE_
16295: #define _V_ENVELOPE_
16295: 
16295: #include "mdct.h"
16295: 
16295: #define VE_PRE    16
16295: #define VE_WIN    4
16295: #define VE_POST   2
16295: #define VE_AMP    (VE_PRE+VE_POST-1)
16295: 
16295: #define VE_BANDS  7
16295: #define VE_NEARDC 15
16295: 
16295: #define VE_MINSTRETCH 2   /* a bit less than short block */
16295: #define VE_MAXSTRETCH 12  /* one-third full block */
16295: 
16295: typedef struct {
16295:   float ampbuf[VE_AMP];
16295:   int   ampptr;
16295: 
16295:   float nearDC[VE_NEARDC];
16295:   float nearDC_acc;
16295:   float nearDC_partialacc;
16295:   int   nearptr;
16295: 
16295: } envelope_filter_state;
16295: 
16295: typedef struct {
16295:   int begin;
16295:   int end;
16295:   float *window;
16295:   float total;
16295: } envelope_band;
16295: 
16295: typedef struct {
16295:   int ch;
16295:   int winlength;
16295:   int searchstep;
16295:   float minenergy;
16295: 
16295:   mdct_lookup  mdct;
16295:   float       *mdct_win;
16295: 
16295:   envelope_band          band[VE_BANDS];
16295:   envelope_filter_state *filter;
16295:   int   stretch;
16295: 
16295:   int                   *mark;
16295: 
16295:   long storage;
16295:   long current;
16295:   long curmark;
16295:   long cursor;
16295: } envelope_lookup;
16295: 
16295: extern void _ve_envelope_init(envelope_lookup *e,vorbis_info *vi);
16295: extern void _ve_envelope_clear(envelope_lookup *e);
16295: extern long _ve_envelope_search(vorbis_dsp_state *v);
16295: extern void _ve_envelope_shift(envelope_lookup *e,long shift);
16295: extern int  _ve_envelope_mark(vorbis_dsp_state *v);
16295: 
16295: 
16295: #endif
