118588: /* This Source Code Form is subject to the terms of the Mozilla Public
118588:  * License, v. 2.0. If a copy of the MPL was not distributed with this
118588:  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
118588: 
118588: // This test makes sure that private browsing turns off doesn't cause zoom
118588: // settings to be reset on tab switch (bug 464962)
118588: 
118588: function test() {
118588:   waitForExplicitFinish();
118588: 
123905:   function testZoom(aWindow, aCallback) {
123905:     executeSoon(function() {
123905:       let tabAbout = aWindow.gBrowser.addTab();
123905:       aWindow.gBrowser.selectedTab = tabAbout;
123905: 
123905:       let aboutBrowser = aWindow.gBrowser.getBrowserForTab(tabAbout);
118588:       aboutBrowser.addEventListener("load", function onAboutBrowserLoad() {
118588:         aboutBrowser.removeEventListener("load", onAboutBrowserLoad, true);
123905:         let tabMozilla = aWindow.gBrowser.addTab();
123905:         aWindow.gBrowser.selectedTab = tabMozilla;
118588: 
123905:         let mozillaBrowser = aWindow.gBrowser.getBrowserForTab(tabMozilla);
118588:         mozillaBrowser.addEventListener("load", function onMozillaBrowserLoad() {
118588:           mozillaBrowser.removeEventListener("load", onMozillaBrowserLoad, true);
123905:           let mozillaZoom = aWindow.ZoomManager.zoom;
118588: 
118588:           // change the zoom on the mozilla page
137506:           aWindow.FullZoom.enlarge();
118588:           // make sure the zoom level has been changed
123905:           isnot(aWindow.ZoomManager.zoom, mozillaZoom, "Zoom level can be changed");
123905:           mozillaZoom = aWindow.ZoomManager.zoom;
118588: 
118588:           // switch to about: tab
123905:           aWindow.gBrowser.selectedTab = tabAbout;
118588: 
118588:           // switch back to mozilla tab
123905:           aWindow.gBrowser.selectedTab = tabMozilla;
118588: 
118588:           // make sure the zoom level has not changed
123905:           is(aWindow.ZoomManager.zoom, mozillaZoom,
118588:             "Entering private browsing should not reset the zoom on a tab");
118588: 
118588:           // cleanup
137506:           aWindow.FullZoom.reset();
123905:           aWindow.gBrowser.removeTab(tabMozilla);
123905:           aWindow.gBrowser.removeTab(tabAbout);
123905:           aWindow.close();
123905:           aCallback();
118588:         }, true);
118588:         mozillaBrowser.contentWindow.location = "about:mozilla";
118588:       }, true);
118588:       aboutBrowser.contentWindow.location = "about:";
123905:     });
118588:   }
123905: 
123905:   whenNewWindowLoaded({private: true}, function(privateWindow) {
123905:     testZoom(privateWindow, finish);
123905:   });
123905: }
