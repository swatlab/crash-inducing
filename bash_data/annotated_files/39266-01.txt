36171: namespace mozilla {
36171: namespace _ipdltest {
36171: 
36171: rpc protocol PTestRPCRaces {
36171: both:
36171:     rpc Race() returns (bool hasReply);
36171:     rpc StackFrame() returns ();
39266:     rpc StackFrame3() returns ();
39266: 
36171: parent:
36171:     sync StartRace();
39266:     rpc Parent();
39266:     sync GetAnsweredParent() returns (bool answeredParent);
39266: 
36171: child:
36171:     Start();
36171:     Wakeup();
39266:     Wakeup3();
39266:     rpc Child();
36171:     __delete__();
36171: 
36171: state START:
36171:     send Start goto TEST1;
36171: 
36171: // First test: race while no other messages are on the RPC stack
36171: state TEST1:
36171:     recv StartRace goto RACE1;
36171: state RACE1:
36171:     call Race goto DUMMY1_1;
36171:     answer Race goto DUMMY1_2;
36171: state DUMMY1_1:
36171:     answer Race goto TEST2;
36171: state DUMMY1_2:
36171:     call Race goto TEST2;
36171: 
36171: // Second test: race while other messages are on the RPC stack
36171: state TEST2:
36171:     call StackFrame goto MORESTACK;
36171: state MORESTACK:
36171:     answer StackFrame goto STARTRACE;
36171: state STARTRACE:
36171:     send Wakeup goto RACE2;
36171: state RACE2:
36171:     call Race goto DUMMY2_1;
36171:     answer Race goto DUMMY2_2;
36171: state DUMMY2_1:
39266:     answer Race goto TEST3;
36171: state DUMMY2_2:
39266:     call Race goto TEST3;
39266: 
39266: // Third test: resolve race using custom policy
39266: state TEST3:
39266:     call StackFrame3 goto MORESTACK3;
39266: state MORESTACK3:
39266:     answer StackFrame3 goto STARTRACE3;
39266: state STARTRACE3:
39266:     send Wakeup3 goto RACE3;
39266: state RACE3:
39266:     call Child goto DUMMY3_1;
39266:     answer Parent goto DUMMY3_2;
39266: state DUMMY3_1:
39266:     answer Parent goto CHECK;
39266: state DUMMY3_2:
39266:     call Child goto CHECK;
39266: state CHECK:
39266:     recv GetAnsweredParent goto DYING;
36171: 
36171: state DYING:
36171:     send __delete__;
36171: };
36171: 
36171: } // namespace _ipdltest
36171: } // namespace mozilla
