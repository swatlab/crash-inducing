43066: /* -*- Mode: c++; tab-width: 40; indent-tabs-mode: nil; c-basic-offset: 4; -*- */
43066: /* ***** BEGIN LICENSE BLOCK *****
43066:  * Version: MPL 1.1/GPL 2.0/LGPL 2.1
43066:  *
43066:  * The contents of this file are subject to the Mozilla Public License Version
43066:  * 1.1 (the "License"); you may not use this file except in compliance with
43066:  * the License. You may obtain a copy of the License at
43066:  * http://www.mozilla.org/MPL/
43066:  *
43066:  * Software distributed under the License is distributed on an "AS IS" basis,
43066:  * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
43066:  * for the specific language governing rights and limitations under the
43066:  * License.
43066:  *
43066:  * The Original Code is mozilla.org code.
43066:  *
43066:  * The Initial Developer of the Original Code is
43066:  *   Mozilla Foundation
43066:  * Portions created by the Initial Developer are Copyright (C) 2009-2010
43066:  * the Initial Developer. All Rights Reserved.
43066:  *
43066:  * Contributor(s):
43066:  *   Vladimir Vukicevic <vladimir@pobox.com>
43066:  *
43066:  * Alternatively, the contents of this file may be used under the terms of
43066:  * either the GNU General Public License Version 2 or later (the "GPL"), or
43066:  * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
43066:  * in which case the provisions of the GPL or the LGPL are applicable instead
43066:  * of those above. If you wish to allow use of your version of this file only
43066:  * under the terms of either the GPL or the LGPL, and not to allow others to
43066:  * use your version of this file under the terms of the MPL, indicate your
43066:  * decision by deleting the provisions above and replace them with the notice
43066:  * and other provisions required by the GPL or the LGPL. If you do not delete
43066:  * the provisions above, a recipient may use your version of this file under
43066:  * the terms of any one of the MPL, the GPL or the LGPL.
43066:  *
43066:  * ***** END LICENSE BLOCK ***** */
43066: 
43066: #ifndef nsAppShell_h__
43066: #define nsAppShell_h__
43066: 
43066: #include "nsBaseAppShell.h"
43066: #include "nsCOMPtr.h"
43066: #include "nsTArray.h"
51723: #include "nsInterfaceHashtable.h"
43066: 
43066: #include "prcvar.h"
43066: 
43066: namespace mozilla {
43066: class AndroidGeckoEvent;
43066: bool ProcessNextEvent();
43066: void NotifyEvent();
43066: }
43066: 
43066: class nsAppShell :
43066:     public nsBaseAppShell
43066: {
43066: public:
43066:     static nsAppShell *gAppShell;
43066:     static mozilla::AndroidGeckoEvent *gEarlyEvent;
43066: 
43066:     nsAppShell();
43066: 
60299:     NS_DECL_ISUPPORTS_INHERITED
60299:     NS_DECL_NSIOBSERVER
60299: 
43066:     nsresult Init();
43066: 
43066:     void NotifyNativeEvent();
43066: 
43066:     virtual PRBool ProcessNextNativeEvent(PRBool mayWait);
43066: 
43066:     void PostEvent(mozilla::AndroidGeckoEvent *event);
43066:     void RemoveNextEvent();
44134:     void OnResume();
44134: 
51723:     nsresult AddObserver(const nsAString &aObserverKey, nsIObserver *aObserver);
51723:     void CallObserver(const nsAString &aObserverKey, const nsAString &aTopic, const nsAString &aData);
51723:     void RemoveObserver(const nsAString &aObserverKey);
60059:     void NotifyObservers(nsISupports *aSupports, const char *aTopic, const PRUnichar *aData);
51723: 
43066: protected:
43066:     virtual void ScheduleNativeEventCallback();
43066:     virtual ~nsAppShell();
43066: 
43066:     int mNumDraws;
43066:     PRLock *mQueueLock;
43066:     PRLock *mCondLock;
43066:     PRCondVar *mQueueCond;
43066:     nsTArray<mozilla::AndroidGeckoEvent *> mEventQueue;
51723:     nsInterfaceHashtable<nsStringHashKey, nsIObserver> mObserversHash;
43066: 
43066:     mozilla::AndroidGeckoEvent *GetNextEvent();
43066:     mozilla::AndroidGeckoEvent *PeekNextEvent();
43066: };
43066: 
43066: #endif // nsAppShell_h__
43066: 
