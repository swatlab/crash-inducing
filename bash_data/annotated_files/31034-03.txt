29346: diff --git a/media/libvorbis/lib/vorbis_synthesis.c b/media/libvorbis/lib/vorbis_synthesis.c
29346: index b7b2399..05774fd 100644
29346: --- a/media/libvorbis/lib/vorbis_synthesis.c
29346: +++ b/media/libvorbis/lib/vorbis_synthesis.c
29346: @@ -19,22 +19,26 @@
29346:  #include <ogg/ogg.h>
29346:  #include "vorbis/codec.h"
29346:  #include "codec_internal.h"
29346:  #include "registry.h"
29346:  #include "misc.h"
29346:  #include "os.h"
29346:  
29346:  int vorbis_synthesis(vorbis_block *vb,ogg_packet *op){
29346: -  vorbis_dsp_state     *vd=vb->vd;
29346: -  private_state        *b=vd->backend_state;
29346: -  vorbis_info          *vi=vd->vi;
29346: -  codec_setup_info     *ci=vi->codec_setup;
29346: -  oggpack_buffer       *opb=&vb->opb;
29346: +  vorbis_dsp_state     *vd= vb ? vb->vd : 0;
29346: +  private_state        *b= vd ? vd->backend_state : 0;
29346: +  vorbis_info          *vi= vd ? vd->vi : 0;
29346: +  codec_setup_info     *ci= vi ? vi->codec_setup : 0;
29346: +  oggpack_buffer       *opb=vb ? &vb->opb : 0;
29346:    int                   type,mode,i;
29346: +
29346: +  if (!vd || !b || !vi || !ci || !opb) {
29346: +    return OV_EBADPACKET;
29346: +  }
29346:  
29346:    /* first things first.  Make sure decode is ready */
29346:    _vorbis_block_ripcord(vb);
29346:    oggpack_readinit(opb,op->packet,op->bytes);
29346:  
29346:    /* Check the packet type */
29346:    if(oggpack_read(opb,1)!=0){
29346:      /* Oops.  This is not an audio data packet */
