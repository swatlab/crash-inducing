 98983: # This Source Code Form is subject to the terms of the Mozilla Public
 98983: # License, v. 2.0. If a copy of the MPL was not distributed with this
 98983: # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 35947: 
 35947: DEPTH = ../../../..
 35947: topsrcdir = @top_srcdir@
 35947: srcdir = @srcdir@
 35947: VPATH = @srcdir@
 35947: 
 35947: include $(DEPTH)/config/autoconf.mk
 35963: 
 35963: TOOL_DIRS += app
 35963: 
 35963: MODULE = ipdlunittest
 35963: 
 35963: EXPORTS_NAMESPACES = mozilla/_ipdltest
 35963: EXPORTS_mozilla/_ipdltest =  \
 35963:   IPDLUnitTests.h  \
 42302:   IPDLUnitTestProcessChild.h  \
 36137:   IPDLUnitTestTypes.h \
 35963:   $(NULL)
 35963: 
 35963: LIBRARY_NAME = $(MODULE)_s
 35963: LIBXUL_LIBRARY = 1
 35963: FORCE_STATIC_LIB = 1
 35963: EXPORT_LIBRARY = 1
 35963: 
 35963: IPDLTESTS = \
 39616:   TestBlockChild \
 71248:   TestBridgeMain \
 39616:   TestCrashCleanup \
 42565:   TestDataStructures \
 39616:   TestDesc \
 63895:   TestFailedCtor \
 39616:   TestHangs \
 42567:   TestJSON \
 39616:   TestLatency \
 39616:   TestManyChildAllocs  \
 39616:   TestMultiMgrs  \
 39616:   TestNestedLoops \
 71254:   TestOpens \
 39616:   TestRPCErrorCleanup \
 39616:   TestRPCRaces \
 39616:   TestRPCShutdownRace \
 60364:   TestRaceDeferral \
 51833:   TestRacyReentry  \
 39616:   TestRacyRPCReplies  \
 69340:   TestRacyUndefer \
 35990:   TestSanity  \
 41368:   TestSelfManageRoot \
 39616:   TestShmem \
 39616:   TestShutdown \
 38683:   TestStackHooks \
 73848:   TestSyncError \
 73848:   TestSyncHang \
 37386:   TestSyncWakeup \
104602:   TestBadActor \
 35963:   $(NULL)
 35963: 
 40909: ifeq ($(OS_ARCH),Linux)
 40909: IPDLTESTS += TestSysVShmem
 40909: endif
 40909: 
 71248: EXTRA_PROTOCOLS = \
 71248:   TestBridgeSub \
 71248:   $(NULL)
 71235: 
 35963: IPDLTESTSRCS = $(addsuffix .cpp,$(IPDLTESTS))
 35963: IPDLTESTHDRS = $(addprefix $(srcdir)/,$(addsuffix .h,$(IPDLTESTS)))
 35963: 
 35963: TESTER_TEMPLATE := $(srcdir)/IPDLUnitTests.template.cpp
 35963: GENTESTER := $(srcdir)/genIPDLUnitTests.py
 35963: 
 35963: CPPSRCS =  \
 35963:   IPDLUnitTests.cpp  \
 35963:   IPDLUnitTestSubprocess.cpp  \
 42302:   IPDLUnitTestProcessChild.cpp  \
 35963:   $(IPDLTESTSRCS)  \
 35963:   $(NULL)
 35963: 
 35963: include $(topsrcdir)/config/config.mk
 35963: include $(topsrcdir)/ipc/chromium/chromium-config.mk
 35947: include $(topsrcdir)/config/rules.mk
 35947: 
 35947: 
 36168: IPDLUNITTEST_BIN = $(DEPTH)/dist/bin/ipdlunittest$(BIN_SUFFIX)
 35963: 
 36170: IPDLUnitTests.cpp : Makefile.in $(GENTESTER) $(TESTER_TEMPLATE) $(IPDLTESTHDRS)
 71235: 	$(PYTHON) $(GENTESTER) $(TESTER_TEMPLATE) -t $(IPDLTESTS) -e $(EXTRA_PROTOCOLS) > $@
 35963: 
 83466: check-proc::
 35963: 	@$(EXIT_ON_ERROR)  \
 35963: 	for test in $(IPDLTESTS); do  \
 36168: 		 $(RUN_TEST_PROGRAM) $(IPDLUNITTEST_BIN) $$test ;  \
 35963: 	done
 36168: 
 83466: check-thread::
 83466: 	@$(EXIT_ON_ERROR)  \
 83466: 	for test in $(IPDLTESTS); do  \
 83466: 		 $(RUN_TEST_PROGRAM) $(IPDLUNITTEST_BIN) thread:$$test ;  \
 83466: 	done
 83466: 
 83466: check:: check-proc check-thread
 83466: 
 36168: check-valgrind::
 36168: 	@$(EXIT_ON_ERROR)  \
 36168: 	for test in $(IPDLTESTS); do  \
 36168: 		 $(RUN_TEST_PROGRAM) -g -d \
 37310:                    valgrind -a '--leak-check=full --trace-children=yes -q' \
 36168:                    $(IPDLUNITTEST_BIN) $$test ;  \
 36168: 	done
