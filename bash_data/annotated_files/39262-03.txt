38120: #ifndef mozilla__ipdltest_TestHangs_h
38120: #define mozilla__ipdltest_TestHangs_h 1
38120: 
38120: #include "mozilla/_ipdltest/IPDLUnitTests.h"
38120: 
38120: #include "mozilla/_ipdltest/PTestHangsParent.h"
38120: #include "mozilla/_ipdltest/PTestHangsChild.h"
38120: 
38120: namespace mozilla {
38120: namespace _ipdltest {
38120: 
38120: 
38120: class TestHangsParent :
38120:     public PTestHangsParent
38120: {
38120: public:
38120:     TestHangsParent();
38120:     virtual ~TestHangsParent();
38120: 
38120:     void Main();
38120: 
38120: protected:
38120:     NS_OVERRIDE
38120:     virtual bool ShouldContinueFromReplyTimeout();
38120: 
38120:     NS_OVERRIDE
39262:     virtual bool RecvNonce() {
39262:         return true;
39262:     }
39262: 
39262:     NS_OVERRIDE
38120:     virtual bool AnswerStackFrame();
38120: 
38120:     NS_OVERRIDE
38120:     virtual void ActorDestroy(ActorDestroyReason why)
38120:     {
38120:         if (AbnormalShutdown != why)
38120:             fail("unexpected destruction!");  
38120:         passed("ok");
38120:         QuitParent();
38120:     }
38120: 
39262:     void CleanUp();
39262: 
38120:     // XXX hack around lack of State()
38120:     int mFramesToGo;
39262:     bool mDetectedHang;
38120: };
38120: 
38120: 
38120: class TestHangsChild :
38120:     public PTestHangsChild
38120: {
38120: public:
38120:     TestHangsChild();
38120:     virtual ~TestHangsChild();
38120: 
38120: protected:
38120:     NS_OVERRIDE
39262:     virtual bool RecvStart() {
39262:         if (!SendNonce())
39262:             fail("sending Nonce");
39262:         return true;
39262:     }
39262: 
39262:     NS_OVERRIDE
38120:     virtual bool AnswerStackFrame()
38120:     {
39262:         if (CallStackFrame())
39262:             fail("should have failed");
38120:         return true;
38120:     }
38120: 
38120:     NS_OVERRIDE
38120:     virtual bool AnswerHang();
38120: 
38120:     NS_OVERRIDE
38120:     virtual void ActorDestroy(ActorDestroyReason why)
38120:     {
39262:         if (AbnormalShutdown != why)
39262:             fail("unexpected destruction!");
39262:         QuitChild();
38120:     }
38120: };
38120: 
38120: 
38120: } // namespace _ipdltest
38120: } // namespace mozilla
38120: 
38120: 
38120: #endif // ifndef mozilla__ipdltest_TestHangs_h
