35947: # ***** BEGIN LICENSE BLOCK *****
35947: # Version: MPL 1.1/GPL 2.0/LGPL 2.1
35947: #
35947: # The contents of this file are subject to the Mozilla Public License Version
35947: # 1.1 (the "License"); you may not use this file except in compliance with
35947: # the License. You may obtain a copy of the License at
35947: # http://www.mozilla.org/MPL/
35947: #
35947: # Software distributed under the License is distributed on an "AS IS" basis,
35947: # WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
35947: # for the specific language governing rights and limitations under the
35947: # License.
35947: #
35947: # The Original Code is Mozilla Firefox.
35947: #
35947: # The Initial Developer of the Original Code is
35947: # The Mozilla Foundation <http://www.mozilla.org/>.
35947: # Portions created by the Initial Developer are Copyright (C) 2009
35947: # the Initial Developer. All Rights Reserved.
35947: #
35947: # Contributor(s):
35947: #
35947: # Alternatively, the contents of this file may be used under the terms of
35947: # either the GNU General Public License Version 2 or later (the "GPL"), or
35947: # the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
35947: # in which case the provisions of the GPL or the LGPL are applicable instead
35947: # of those above. If you wish to allow use of your version of this file only
35947: # under the terms of either the GPL or the LGPL, and not to allow others to
35947: # use your version of this file under the terms of the MPL, indicate your
35947: # decision by deleting the provisions above and replace them with the notice
35947: # and other provisions required by the GPL or the LGPL. If you do not delete
35947: # the provisions above, a recipient may use your version of this file under
35947: # the terms of any one of the MPL, the GPL or the LGPL.
35947: #
35947: # ***** END LICENSE BLOCK *****
35947: 
35947: DEPTH = ../../../..
35947: topsrcdir = @top_srcdir@
35947: srcdir = @srcdir@
35947: VPATH = @srcdir@
35947: 
35947: include $(DEPTH)/config/autoconf.mk
35963: 
35963: TOOL_DIRS += app
35963: 
35963: MODULE = ipdlunittest
35963: 
35963: EXPORTS_NAMESPACES = mozilla/_ipdltest
35963: EXPORTS_mozilla/_ipdltest =  \
35963:   IPDLUnitTests.h  \
35963:   IPDLUnitTestThreadChild.h  \
36137:   IPDLUnitTestTypes.h \
35963:   $(NULL)
35963: 
35963: LIBRARY_NAME = $(MODULE)_s
35963: LIBXUL_LIBRARY = 1
35963: FORCE_STATIC_LIB = 1
35963: EXPORT_LIBRARY = 1
35963: 
35990: # Please keep these organized in the order "easy"-to-"hard"
35963: IPDLTESTS = \
35990:   TestSanity  \
46477:   TestRPCErrorCleanup \
35984:   TestLatency \
36171:   TestRPCRaces \
35964:   TestManyChildAllocs  \
35998:   TestDesc \
36153:   TestShmem \
36140:   TestShutdown \
35990:   TestArrays \
35963:   $(NULL)
35963: 
35963: IPDLTESTSRCS = $(addsuffix .cpp,$(IPDLTESTS))
35963: IPDLTESTHDRS = $(addprefix $(srcdir)/,$(addsuffix .h,$(IPDLTESTS)))
35963: 
35963: TESTER_TEMPLATE := $(srcdir)/IPDLUnitTests.template.cpp
35963: GENTESTER := $(srcdir)/genIPDLUnitTests.py
35963: 
35963: CPPSRCS =  \
35963:   IPDLUnitTests.cpp  \
35963:   IPDLUnitTestSubprocess.cpp  \
35963:   IPDLUnitTestThreadChild.cpp  \
35963:   $(IPDLTESTSRCS)  \
35963:   $(NULL)
35963: 
35963: include $(topsrcdir)/config/config.mk
35963: include $(topsrcdir)/ipc/chromium/chromium-config.mk
35947: include $(topsrcdir)/config/rules.mk
35947: 
35947: 
36168: IPDLUNITTEST_BIN = $(DEPTH)/dist/bin/ipdlunittest$(BIN_SUFFIX)
35963: 
36170: IPDLUnitTests.cpp : Makefile.in $(GENTESTER) $(TESTER_TEMPLATE) $(IPDLTESTHDRS)
36170: 	$(PYTHON) $(GENTESTER) $(TESTER_TEMPLATE) $(IPDLTESTS) > $@
35963: 
35947: check::
35963: 	@$(EXIT_ON_ERROR)  \
35963: 	for test in $(IPDLTESTS); do  \
36168: 		 $(RUN_TEST_PROGRAM) $(IPDLUNITTEST_BIN) $$test ;  \
35963: 	done
36168: 
36168: check-valgrind::
36168: 	@$(EXIT_ON_ERROR)  \
36168: 	for test in $(IPDLTESTS); do  \
36168: 		 $(RUN_TEST_PROGRAM) -g -d \
36168:                    valgrind -a '--leak-check=full --error-exitcode=1 --trace-children=yes -q' \
36168:                    $(IPDLUNITTEST_BIN) $$test ;  \
36168: 	done
