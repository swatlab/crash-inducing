34546: /* -*- Mode: C++; tab-width: 40; indent-tabs-mode: nil; c-basic-offset: 2 -*- */
34546: /* ***** BEGIN LICENSE BLOCK *****
34546:  * Version: MPL 1.1/GPL 2.0/LGPL 2.1
34546:  *
34546:  * The contents of this file are subject to the Mozilla Public License Version
34546:  * 1.1 (the "License"); you may not use this file except in compliance with
34546:  * the License. You may obtain a copy of the License at
34546:  * http://www.mozilla.org/MPL/
34546:  *
34546:  * Software distributed under the License is distributed on an "AS IS" basis,
34546:  * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
34546:  * for the specific language governing rights and limitations under the
34546:  * License.
34546:  *
34546:  * The Original Code is mozilla.org code.
34546:  *
34546:  * The Initial Developer of the Original Code is
34546:  *   Mozilla Corp
34546:  * Portions created by the Initial Developer are Copyright (C) 2009
34546:  * the Initial Developer. All Rights Reserved.
34546:  *
34546:  * Contributor(s):
34546:  *  Vladimir Vukicevic <vladimir@pobox.com>
34546:  *
34546:  * Alternatively, the contents of this file may be used under the terms of
34546:  * either the GNU General Public License Version 2 or later (the "GPL"), or
34546:  * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
34546:  * in which case the provisions of the GPL or the LGPL are applicable instead
34546:  * of those above. If you wish to allow use of your version of this file only
34546:  * under the terms of either the GPL or the LGPL, and not to allow others to
34546:  * use your version of this file under the terms of the MPL, indicate your
34546:  * decision by deleting the provisions above and replace them with the notice
34546:  * and other provisions required by the GPL or the LGPL. If you do not delete
34546:  * the provisions above, a recipient may use your version of this file under
34546:  * the terms of any one of the MPL, the GPL or the LGPL.
34546:  *
34546:  * ***** END LICENSE BLOCK ***** */
34546: 
34546: #ifndef IN_WINDOWS_DLL_BLOCKLIST
34546: #error This file should only be included by nsWindowsDllBlocklist.cpp
34546: #endif
34546: 
34546: #define ALL_VERSIONS   ((unsigned long long)-1LL)
34546: 
36205: // DLLs sometimes ship without a version number, particularly early
36205: // releases. Blocking "version <= 0" has the effect of blocking unversioned
36205: // DLLs (since the call to get version info fails), but not blocking
36205: // any versioned instance.
36205: #define UNVERSIONED    ((unsigned long long)0LL)
36205: 
35178: // Convert the 4 (decimal) components of a DLL version number into a
35178: // single unsigned long long, as needed by the blocklist
35178: #define MAKE_VERSION(a,b,c,d)\
35178:   ((a##ULL << 48) + (b##ULL << 32) + (c##ULL << 16) + d##ULL)
35178: 
34546: struct DllBlockInfo {
34546:   // The name of the DLL -- in LOWERCASE!  It will be compared to
34546:   // a lowercase version of the DLL name only.
34546:   const char *name;
34546: 
34546:   // If maxVersion is ALL_VERSIONS, we'll block all versions of this
34546:   // dll.  Otherwise, we'll block all versions less than or equal to
34546:   // the given version, as queried by GetFileVersionInfo and
34546:   // VS_FIXEDFILEINFO's dwFileVersionMS and dwFileVersionLS fields.
34546:   //
34546:   // Note that the version is usually 4 components, which is A.B.C.D
34546:   // encoded as 0x AAAA BBBB CCCC DDDD ULL (spaces added for clarity),
34546:   // but it's not required to be of that format.
34546:   unsigned long long maxVersion;
34546: };
34546: 
34546: static DllBlockInfo sWindowsDllBlocklist[] = {
34546:   // EXAMPLE:
34546:   // { "uxtheme.dll", ALL_VERSIONS },
34546:   // { "uxtheme.dll", 0x0000123400000000ULL },
34546:   // The DLL name must be in lowercase!
34546:   
35178:   // NPFFAddon - Known malware
35178:   { "npffaddon.dll", ALL_VERSIONS},
35178: 
35178:   // AVG 8 - Antivirus vendor AVG, old version, plugin already blocklisted
35178:   {"avgrsstx.dll", MAKE_VERSION(8,5,0,401)},
35178:   
35393:   // calc.dll - Suspected malware
35393:   {"calc.dll", MAKE_VERSION(1,0,0,1)},
35393: 
35410:   // hook.dll - Suspected malware
35410:   {"hook.dll", ALL_VERSIONS},
35410:   
36205:   // GoogleDesktopNetwork3.dll - Extremely old, unversioned instances
36205:   // of this DLL cause crashes
36205:   {"googledesktopnetwork3.dll", UNVERSIONED},
36205: 
36855:   // rdolib.dll - Suspected malware
36855:   {"rdolib.dll", MAKE_VERSION(6,0,88,4)},
36855: 
36854:   // fgjk4wvb.dll - Suspected malware
36854:   {"fgjk4wvb.dll", MAKE_VERSION(8,8,8,8)},
36854:   
37322:   // radhslib.dll - Naomi internet filter - unmaintained since 2006
37322:   {"radhslib.dll", UNVERSIONED},
37322: 
38077:   // Music download filter for vkontakte.ru - old instances
38077:   // of this DLL cause crashes
62756:   {"vksaver.dll", MAKE_VERSION(2,2,2,0)},
38077: 
47944:   // Topcrash in Firefox 4.0b1
47944:   {"rlxf.dll", MAKE_VERSION(1,2,323,1)},
47944: 
51784:   // psicon.dll - Topcrashes in Thunderbird, and some crashes in Firefox
51784:   // Adobe photoshop library, now redundant in later installations
51784:   {"psicon.dll", ALL_VERSIONS},
51784: 
62514:   // Topcrash in Firefox 4 betas (bug 618899)
62514:   {"accelerator.dll", MAKE_VERSION(3,2,1,6)},
62514:   
34546:   // leave these two in always for tests
34546:   { "mozdllblockingtest.dll", ALL_VERSIONS },
34546:   { "mozdllblockingtest_versioned.dll", 0x0000000400000000ULL },
34546: 
34546:   { NULL, 0 }
34546: };
